{"version":3,"file":"_server.ts-840dbaa6.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/changelog/_server.ts.js"],"sourcesContent":["import { j as json } from \"../../../../chunks/index.js\";\nimport axios from \"axios\";\nimport { URL } from \"url\";\nasync function POST({ request }) {\n  const { ApiKey, queryLink, patToken, model } = await request.json();\n  const url = new URL(queryLink);\n  const pathParts = url.pathname.split(\"/\").filter(Boolean);\n  const organization = url.hostname.split(\".\")[0];\n  const project = pathParts[0];\n  const id = pathParts[pathParts.length - 1];\n  console.log(\"Organization:\", organization);\n  console.log(\"Project:\", project);\n  console.log(\"ID:\", id);\n  const apiUrl = `https://dev.azure.com/${organization}/${project}/_apis/wit/wiql/${id}?api-version=6.0`;\n  console.log(\"PAT Token:\", patToken);\n  console.log(\"Fetching from Azure DevOps API:\", apiUrl);\n  const response = await axios.get(apiUrl, {\n    headers: {\n      \"Authorization\": `Basic ${Buffer.from(`:${patToken}`).toString(\"base64\")}`,\n      \"Content-Type\": \"application/json\"\n    }\n  });\n  let data = null;\n  if (response.headers[\"content-type\"]?.includes(\"application/json\")) {\n    data = response.data;\n  }\n  const workItemDetails = await Promise.all(data[\"workItems\"].map(async (item) => {\n    const response2 = await axios.get(item[\"url\"], {\n      headers: {\n        \"Authorization\": `Basic ${Buffer.from(`:${patToken}`).toString(\"base64\")}`,\n        \"Content-Type\": \"application/json\"\n      }\n    });\n    return { id: item[\"url\"].split(\"/\").pop(), ...response2.data };\n  }));\n  const closedWorkItems = workItemDetails.filter((item) => \"fields\" in item && item[\"fields\"][\"System.State\"] === \"Closed\");\n  const messages = [\n    { \"role\": \"system\", \"content\": \"You are a helpful assistant.\" },\n    { \"role\": \"user\", \"content\": \"Create a changelog from the following closed work items: \" + closedWorkItems.map((item) => `#${item.id} - ${item[\"fields\"][\"System.Title\"]}`).join(\", \") + \". Make it a short comprehensive list in dutish so the end user can see the improvement we made with this release\" }\n  ];\n  console.log(model);\n  if (model.includes(\"OpenAI/gpt\")) {\n    console.log(\"Sending to OpenAI API...\");\n    const OpenAIModel = model.replace(\"OpenAI/\", \"\");\n    const openAiResponse = await axios.post(`https://api.openai.com/v1/chat/completions`, {\n      model: OpenAIModel,\n      messages,\n      temperature: 0.3\n      // temperature: temperature, for later\n    }, {\n      headers: { \"Authorization\": `Bearer ${ApiKey}`, \"Content-Type\": \"application/json\" }\n    });\n    console.log(OpenAIModel);\n    console.log(\"Response from OpenAI API:\");\n    const openAiData = openAiResponse.data;\n    console.log(openAiData.choices[0].message.content);\n    return json({\n      message: openAiData.choices[0].message.content\n    });\n  } else {\n    console.log(\"Sending to OpenRouter API...\");\n    const openRouterModel = model.replace(\"OpenRouter/\", \"\");\n    const openRouterResponse = await axios.post(`https://openrouter.ai/api/v1/chat/completions`, {\n      model: openRouterModel,\n      // temperature: temperature, for later\n      messages\n    }, {\n      headers: {\n        \"Authorization\": `Bearer ${ApiKey}`,\n        \"Content-Type\": \"application/json\",\n        \"HTTP-Referer\": \"http://google.com\",\n        // replace with your site URL\n        \"X-Title\": \"Google\"\n        // replace with your site name\n      }\n    });\n    console.log(\"Response from OpenRouter API:\");\n    const openRouterData = openRouterResponse.data;\n    console.log(openRouterData.choices[0].message.content);\n    return json({\n      message: openRouterData.choices[0].message.content\n    });\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}